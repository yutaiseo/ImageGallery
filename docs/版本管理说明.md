# 版本管理说明

## 文件格式

所有版本信息维护在项目根目录的 `VERSION` 文件中：

```
v1.1.0
2026-02-11
Stable
```

**每行说明：**
- **第 1 行** - 版本号（格式：v主.次.补）
- **第 2 行** - 发布日期（格式：YYYY-MM-DD）
- **第 3 行** - 发布状态（Stable/Beta/RC/Alpha）

## 自动加载机制

版本号通过以下方式自动加载，**无需硬编码**：

### 后端（PHP）

#### 1. ctrol/config/config.php
```php
get_app_version()  // 函数：从VERSION文件读取
APP_VERSION        // 常量：版本号 (e.g., "v1.1.0")
APP_VERSION_NAME   // 常量：发布状态 (e.g., "Stable")
APP_RELEASE_DATE   // 常量：发布日期 (e.g., "2026-02-11")
```

在 ctrol 下的所有页面可直接使用这些常量：
```php
<?php echo APP_VERSION; ?>  // 输出：v1.1.0
```

#### 2. Gallery/footer.php
自动检测：
- 如果已加载 config.php（定义了 APP_VERSION），使用常量
- 否则直接从 VERSION 文件读取版本号

适用于所有 Gallery 页面（包括未经过 ctrol 的页面）

## 升级版本步骤

只需编辑**一个文件** - `VERSION`：

```bash
# 示例：升级从 v1.1.0 → v1.2.0
# 编辑 VERSION 文件如下：

v1.2.0
2026-02-15
Stable
```

所有 PHP 代码会自动读取新的版本号，无需修改任何源代码。

## 版本号规范

采用 **Semantic Versioning** (语义化版本)：

```
v主.次.补
 ↓ ↓  ↓
 │ │  └─── 补丁版本（修复 bug）
 │ └────── 次版本（新增功能，向后兼容）
 └──────── 主版本（重大更改，可能不兼容）

# 示例
v1.0.0  - 初始版本
v1.1.0  - 添加认证系统（功能升级）
v1.1.1  - 修复登录 bug（补丁修复）
v2.0.0  - 架构重构（重大版本）
```

## 发布状态

| 状态 | 说明 | 用途 |
|------|------|------|
| Stable | 稳定版 | 生产环境，功能完整且已充分测试 |
| Beta | 测试版 | 功能完整但可能有 bug，观望者 |
| RC | 候选版 | 预发布，仅修复 bug，不增加功能 |
| Alpha | 内测版 | 早期测试版，功能不稳定 |

## 版本查询

### 代码中查询
```php
// 任何地方都可以查询
if (defined('APP_VERSION')) {
    echo "当前版本：" . APP_VERSION;
}
```

### 用户界面
在页面底部显示：`图片管理系统 v1.1.0 © 2026`

### 数据库版本跟踪（可选）
可在 `site_settings` 表添加：
```sql
INSERT INTO site_settings (setting_key, setting_value) 
VALUES ('app_version', 'v1.1.0');
```

## 注意事项

- ✅ VERSION 文件应该提交到版本控制（git）
- ✅ 每个版本发布前务必更新 VERSION 文件
- ✅ 保持前二行数据格式一致，便于自动化解析
- ✅ 版本号变更应同时更新 [docs/CHANGELOG.md](CHANGELOG.md)

## 自动化集成（未来可选）

若需进一步自动化，可创建脚本：

```bash
#!/bin/bash
# scripts/release.sh
NEW_VERSION=$1
RELEASE_DATE=$(date +%Y-%m-%d)

echo "$NEW_VERSION" > VERSION
echo "$RELEASE_DATE" >> VERSION
echo "Stable" >> VERSION

# 更新文档
# git tag $NEW_VERSION
# git push --tags
```

使用：`./scripts/release.sh v1.2.0`
