# 后台管理系统 - 功能清单（v1.1.0）

## 已实现功能 ✅

### 1️⃣ 仪表盘 (Dashboard)
- **文件**: `ctrol/index.php`
- **功能**:
  - 统计信息展示（用户数、图片数、存储使用等）
  - 系统概览
  - 快速操作按钮

### 2️⃣ 上传图片
- **文件**: `ctrol/uploader.php`
- **功能**:
  - 本地文件上传
  - 远程图片链接添加
  - 文件拖放支持
  - 实时预览
  - 自动验证（大小、格式）
  - 自动标题生成

### 3️⃣ 图片管理
- **文件**: `ctrol/images.php`
- **功能**:
  - 列表展示（响应式网格：PC 4列 / 平板 2列 / 手机 1列）
  - 搜索/筛选（按标题）
  - 编辑图片信息（标题、描述、替换图片）
  - 单个删除（软删除）
  - 批量删除
  - 分页（每页 20 条）
  - 下载功能

### 4️⃣ 用户管理
- **文件**: `ctrol/users.php`
- **功能**:
  - 用户列表
  - 用户创建
  - 用户删除（含批量）
  - 角色管理（admin/superadmin）

### 5️⃣ 回收站
- **文件**: `ctrol/recycle.php`
- **功能**:
  - 已删除图片列表
  - 恢复功能
  - 彻底删除

### 6️⃣ 网站设置
- **文件**: `ctrol/settings.php`
- **功能**:
  - 网站基本信息（标题、描述、Logo 等）
  - ICP/备案号配置
  - CDN 设置
  - 邮件通知配置（可能）

### 7️⃣ 备份管理
- **文件**: `ctrol/backup.php`
- **功能**:
  - 手动备份（一键备份）
  - 定期备份设置（时间、频率）
  - 备份内容选择（数据库、程序代码、上传文件）
  - 备份保留策略（自动清理旧备份）
  - 云服务配置 GUI（OSS/S3/COS/Swift）
  - 备份列表管理（下载/删除）
  - 备份恢复（可选择性恢复）

### 8️⃣ 日志查看
- **文件**: `ctrol/logs.php`
- **功能**:
  - 操作日志
  - 登录日志
  - 日志搜索/过滤
  - 日志导出（CSV）

### 🔐 认证与安全
- **登录系统**: `ctrol/login.php`
  - 用户名/密码认证
  - 密码验证（bcrypt）
  - 会话管理
  - CSRF 保护
  - 登录日志记录

- **登出**: `ctrol/logout.php`
  - 会话清理
  - 操作日志

- **密码修改**: `ctrol/change_password.php`
  - 当前密码验证
  - 新密码强度检查
  - 安全更新

---

## 缺失功能 ⚠️ (建议开发)

### 优先级 1️⃣ (高) - 上传与处理

#### ❌ 批量上传
- 多文件选择/拖拽
- 上传队列与进度

#### ❌ 异步处理流水线
- 上传原图
- 写入任务表
- 后台 Worker 压缩
- 更新任务状态

#### ❌ 第三方接口传图
- API Token
- 上传接口与限流
- 访问日志与统计

### 优先级 2️⃣ (中) - 备份相关

#### ❌ 云备份管理
- 云端备份列表
- 云端备份下载
- 云端备份删除
- 云端同步状态

---

### 优先级 3️⃣ (中) - 用户与权限

#### ❌ 用户权限细粒度控制
- **现有**: admin/superadmin
- **建议**:
  1. 权限模型:
     - 管理员 (全部权限)
     - 编辑 (可上传、编辑、删除图片)
     - 查看 (只读)
     - 贡献者 (仅上传)
  2. 字段级权限
  3. 操作审计

#### ❌ 访问控制 (ACL)
- IP 白名单
- 登录限制 (失败次数、登录时间等)
- 两步验证 (TOTP)
- API 令牌管理

---

### 优先级 3️⃣ (中) - 系统管理

#### ❌ 系统监控面板
- 磁盘使用情况
- 数据库大小
- 请求统计 (QPS、带宽等)
- 错误监控
- 性能告警

#### ❌ 数据库管理
- 数据库表大小统计
- 数据库备份/恢复
- 数据库优化建议
- SQL 执行器（开发用）

#### ❌ 文件管理器
- 浏览上传文件
- 文件删除/移动
- 批量操作
- 文件预览

#### ❌ 定时任务管理
- 查看当前任务
- 任务日志
- 手动触发
- 任务编辑/禁用

---

### 优先级 4️⃣ (低) - 增强功能

#### ❌ 主题/外观设置
- 后台主题切换 (浅色/深色)
- 菜单项自定义
- 短语国际化

#### ❌ 扩展/插件管理
- 第三方插件列表
- 插件启用/禁用
- 插件配置

#### ❌ API 管理
- API 密钥生成
- API 文档
- API 调用统计
- API 限流设置

#### ❌ 公告/通知
- 系统公告发布
- 用户通知
- 邮件模板管理

---

## 当前后台菜单结构

```
仪表盘
├─ 统计信息
└─ 快速操作

上传图片
├─ 拖放上传
├─ 文件预览
└─ 自动验证

图片管理
├─ 列表展示 (响应式)
├─ 搜索筛选
├─ 编辑/删除
└─ 批量操作

用户管理
├─ 用户列表
├─ 用户编辑
└─ 权限设置

回收站
├─ 删除图片列表
├─ 恢复功能
└─ 彻底删除

网站设置
├─ 基本信息
├─ ICP/备案
└─ CDN 配置

备份管理
├─ 手动备份
├─ 定期备份设置
├─ 备份内容选择
├─ ⚠️ 云服务配置 (缺失)
├─ ⚠️ 备份恢复 (缺失)
└─ ⚠️ 云备份管理 (缺失)

日志查看
├─ 操作日志
├─ 登录日志
├─ 搜索筛选
└─ 导出下载
```

---

## 建议优先实现顺序

### Phase 1 (Sprint 1-2)
1. **备份恢复功能** - 备份的核心价值
2. **云服务配置 GUI** - 企业用户必需

### Phase 2 (Sprint 3-4)
3. **用户权限细粒度控制** - 多用户管理
4. **访问控制 (IP 白名单 + 登录限制)** - 安全功能

### Phase 3 (Sprint 5+)
5. 系统监控面板
6. 定时任务管理
7. API 管理

---

## 技术实现建议

### 云服务配置 GUI 实现
```html
<!-- 假设实现方案 -->
<form id="cloudConfigForm">
  <div class="provider-selector">
    <input type="radio" name="provider" value="oss" required>
    <input type="radio" name="provider" value="s3">
    <input type="radio" name="provider" value="cos">
    <input type="radio" name="provider" value="swift">
  </div>
  
  <!-- OSS 配置 (条件显示) -->
  <div id="ossConfig" class="provider-config">
    <input name="oss_endpoint" required>
    <input name="oss_access_key" required>
    <input name="oss_secret_key" required>
    <input name="oss_bucket" required>
  </div>
  
  <!-- 测试按钮 -->
  <button type="button" id="testConnection">测试连接</button>
  <button type="submit">保存配置</button>
</form>
```

### 备份恢复实现
```php
// 伪代码
function restore_from_backup($backupFile) {
    // 1. 验证备份文件完整性
    // 2. 解析 manifest.json
    // 3. 依次恢复：数据库 → 程序文件 → 上传文件
    // 4. 验证恢复结果
    // 5. 操作日志记录
}
```

---

**最后更新**: 2026-02-11 | **版本**: v1.1.0
